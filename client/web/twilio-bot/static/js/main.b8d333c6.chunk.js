(this["webpackJsonptwilio-video-app-react"]=this["webpackJsonptwilio-video-app-react"]||[]).push([[0],{188:function(e,t,n){e.exports=n(306)},306:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(13),c=n.n(i),o=n(357),l=n(356),u=n(363),s=n(14),d=n(155),f=n(362),m=n(3),v=n(4),b=n(341),p=n(160),h=n.n(p),g=n(80),E=n.n(g),O=n(364);function j(e){var t=Object(a.useState)(!!e&&e.isEnabled),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){if(i(!!e&&e.isEnabled),e){var t=function(){return i(!0)},n=function(){return i(!1)};return e.on("enabled",t),e.on("disabled",n),function(){e.off("enabled",t),e.off("disabled",n)}}}),[e]),r}var k=Object(a.createContext)(null);function w(){var e=Object(a.useContext)(k),t=Object(v.a)(e,2);return[t[0],t[1]]}function S(e){var t=e.room,n=e.children,i=Object(a.useState)(null),c=Object(v.a)(i,2),o=c[0],l=c[1];return Object(a.useEffect)((function(){var e=function(){return l(null)};return t.on("disconnected",e),function(){t.off("disconnected",e)}}),[t]),r.a.createElement(k.Provider,{value:[o,function(e){return l((function(t){return t===e?null:e}))}]},n)}var T=n(154),y=n.n(T),P="undefined"!==typeof navigator&&"string"===typeof navigator.userAgent&&/Mobile/.test(navigator.userAgent);function C(){var e=H(),t=e.room.localParticipant,n=e.localTracks,r=e.getLocalVideoTrack,i=e.removeLocalVideoTrack,c=e.onError,o=n.find((function(e){return e.kind.includes("video")})),l=Object(a.useState)(!1),u=Object(v.a)(l,2),s=u[0],d=u[1],f=Object(a.useRef)(),m=Object(a.useCallback)((function(){if(console.log("toggling video"),console.log(s),!s)if(console.log(o),o){f.current=o.mediaStreamTrack.getSettings().deviceId;var e=null===t||void 0===t?void 0:t.unpublishTrack(o);null===t||void 0===t||t.emit("trackUnpublished",e),i()}else d(!0),r({deviceId:{exact:f.current}}).then((function(e){return null===t||void 0===t?void 0:t.publishTrack(e,{priority:"low"})})).catch(c).finally((function(){return d(!1)}))}),[o,t,r,s,c,i]);return[!!o,m]}function x(){var e=H().room,t=C(),n=Object(v.a)(t,2),r=n[0],i=n[1],c=Object(a.useRef)(!1);return Object(a.useEffect)((function(){if(P){var e=function(){"hidden"===document.visibilityState&&r?(c.current=!0,i()):c.current&&(c.current=!1,i())};return document.addEventListener("visibilitychange",e),function(){document.removeEventListener("visibilitychange",e)}}}),[r,e,i]),null}var A=n(15),_={width:1280,height:720,frameRate:24,facingMode:"user"},L=n(31),N=n.n(L);var D=n(17),R=n.n(D);window.TwilioVideo=N.a;var I=Object(a.createContext)(null);function V(e){var t=e.options,n=e.children,i=e.onError,c=void 0===i?function(){}:i,o=e.onDisconnect,l=void 0===o?function(){}:o,u=function(e){console.log("ERROR: ".concat(e.message),e),c(e)},s=function(){var e=Object(a.useState)(),t=Object(v.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(),c=Object(v.a)(i,2),o=c[0],l=c[1],u=Object(a.useState)(!1),s=Object(v.a)(u,2),d=s[0],f=(s[1],Object(a.useCallback)((function(e){console.log("THIS SHOULDNT BE CALLED");var t={},n=new URLSearchParams(window.location.search).get("video-id");if(n){console.log("before video stream:"),console.log(n);var a=document.getElementById(n);console.log("playing"),a.play(),console.log("done starting playing");var i=document.getElementById(n).captureStream();console.log("video stream:"),console.log(i);var c=new N.a.LocalAudioTrack(i.getAudioTracks()[0]);return console.log(c),r(c),Promise.resolve(c)}return e&&(t.deviceId={exact:e}),N.a.createLocalAudioTrack(t).then((function(e){return r(e),e}))}),[])),m=Object(a.useCallback)((function(e){var t=new URLSearchParams(window.location.search).get("video-id");if(t){console.log("before video stream:"),console.log(t);var n=document.getElementById(t);console.log("playing"),n.play(),n.onended=function(){n.currentTime=0,n.play()},console.log("done starting playing");var a=document.getElementById(t).captureStream();console.log("video stream:"),console.log(a),console.log(a.getVideoTracks().length);var i=new N.a.LocalVideoTrack(a.getVideoTracks()[0],{logLevel:"debug",name:"camera-".concat(Date.now())}),c=new N.a.LocalAudioTrack(a.getAudioTracks()[0]);return console.log("setting local video tracks"),r(c),l(i),Promise.resolve(i)}var o=Object(A.a)(Object(A.a)({},_),{},{name:"camera-".concat(Date.now())},e);return N.a.createLocalVideoTrack(o).then((function(e){return l(e),e}))}),[]),b=Object(a.useCallback)((function(){o&&(o.stop(),l(void 0))}),[o]),p=[n,o].filter((function(e){return void 0!==e}));return console.log("returning local tracks"),console.log(p),{localTracks:p,getLocalVideoTrack:m,getLocalAudioTrack:f,isAcquiringLocalTracks:d,removeLocalVideoTrack:b}}(),d=s.localTracks,f=s.getLocalVideoTrack,m=s.getLocalAudioTrack,b=s.isAcquiringLocalTracks,p=s.removeLocalVideoTrack,h=function(e,t,n){var r=Object(a.useState)(new R.a),i=Object(v.a)(r,2),c=i[0],o=i[1],l=Object(a.useState)(!1),u=Object(v.a)(l,2),s=u[0],d=u[1],f=Object(a.useRef)([]),m=Object(a.useRef)(n);return Object(a.useEffect)((function(){f.current=e}),[e]),Object(a.useEffect)((function(){m.current=n}),[n]),{room:c,isConnecting:s,connect:Object(a.useCallback)((function(e){return d(!0),N.a.connect(e,Object(A.a)(Object(A.a)({},m.current),{},{tracks:[]})).then((function(e){o(e);var t=function(){return e.disconnect()};e.once("disconnected",(function(){setTimeout((function(){return o(new R.a)})),window.removeEventListener("beforeunload",t),P&&window.removeEventListener("pagehide",t)})),window.twilioRoom=e,console.log("connecting to room"),console.log(f),f.current.forEach((function(t){console.log("publishing track:"),console.log(t),console.log(t.kind),e.localParticipant.publishTrack(t,{priority:"video"===t.kind?"low":"standard"})})),d(!1),window.addEventListener("beforeunload",t),P&&window.addEventListener("pagehide",t)}),(function(e){t(e),d(!1)}))}),[t])}}(d,u,t),g=h.room,E=h.isConnecting,O=h.connect;return function(e,t){Object(a.useEffect)((function(){var n=function(e,n){n&&t(n)};return e.on("disconnected",n),function(){e.off("disconnected",n)}}),[e,t])}(g,c),function(e,t){var n=e.localParticipant;Object(a.useEffect)((function(){if(n)return n.on("trackPublicationFailed",t),function(){n.off("trackPublicationFailed",t)}}),[n,t])}(g,c),function(e,t){Object(a.useEffect)((function(){return e.on("disconnected",t),function(){e.off("disconnected",t)}}),[e,t])}(g,l),r.a.createElement(I.Provider,{value:{room:g,localTracks:d,isConnecting:E,onError:u,onDisconnect:l,getLocalVideoTrack:f,getLocalAudioTrack:m,connect:O,isAcquiringLocalTracks:b,removeLocalVideoTrack:p}},r.a.createElement(S,{room:g},n),r.a.createElement(x,null))}function H(){var e=Object(a.useContext)(I);if(!e)throw new Error("useVideoContext must be used within a VideoProvider");return e}var U=Object(d.a)((function(e){return Object(f.a)({fab:{margin:e.spacing(1)}})}));function W(e){var t=U(),n=function(){var e=H(),t=e.localTracks,n=e.getLocalAudioTrack,r=t.find((function(e){return"audio"===e.kind}));return[j(r),Object(a.useCallback)((function(){r?r.isEnabled?r.disable():r.enable():n()}),[r])]}(),i=Object(v.a)(n,2),c=i[0],o=i[1];return r.a.createElement(O.a,{title:c?"Mute Audio":"Unmute Audio",placement:"top",PopperProps:{disablePortal:!0}},r.a.createElement(b.a,{className:t.fab,onClick:o,disabled:e.disabled,"data-cy-audio-toggle":!0},c?r.a.createElement(h.a,null):r.a.createElement(E.a,null)))}var B=n(161),M=n.n(B),K=n(58),F=n.n(K),z=Object(d.a)((function(e){return Object(f.a)({fab:{margin:e.spacing(1)}})}));function q(e){var t=z(),n=C(),i=Object(v.a)(n,2),c=i[0],o=i[1],l=Object(a.useRef)(0),u=Object(a.useCallback)((function(){Date.now()-l.current>200&&(l.current=Date.now(),o())}),[o]);return r.a.createElement(O.a,{title:c?"Mute Video":"Unmute Video",placement:"top",PopperProps:{disablePortal:!0}},r.a.createElement(b.a,{className:t.fab,onClick:u,disabled:e.disabled},c?r.a.createElement(M.a,null):r.a.createElement(F.a,null)))}var G=n(81),Q=n.n(G),Y=n(162),J=n.n(Y);function X(){var e=H().room,t=Object(a.useState)(),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){if("connected"===e.state){var t=function(){i(Array.from(e.participants.values()).concat(e.localParticipant).find((function(e){return Array.from(e.tracks.values()).find((function(e){return e.trackName.includes("screen")}))})))};return t(),e.on("trackPublished",t),e.on("trackUnpublished",t),e.on("participantDisconnected",t),e.localParticipant.on("trackPublished",t),e.localParticipant.on("trackUnpublished",t),function(){e.off("trackPublished",t),e.off("trackUnpublished",t),e.off("participantDisconnected",t),e.localParticipant.off("trackPublished",t),e.localParticipant.off("trackUnpublished",t)}}}),[e]),r}var Z=Object(d.a)((function(e){return Object(f.a)({fab:{margin:e.spacing(1),"&[disabled]":{color:"rgba(225, 225, 225, 0.8)",backgroundColor:"rgba(175, 175, 175, 0.6);"}}})}));function $(e){var t=Z(),n=function(){var e=H(),t=e.room,n=e.onError,r=Object(a.useState)(!1),i=Object(v.a)(r,2),c=i[0],o=i[1],l=Object(a.useRef)(null),u=Object(a.useCallback)((function(){navigator.mediaDevices.getDisplayMedia({audio:!1,video:{frameRate:10,height:1080,width:1920}}).then((function(e){var a=e.getTracks()[0];t.localParticipant.publishTrack(a,{name:"screen",priority:"low"}).then((function(e){l.current=function(){t.localParticipant.unpublishTrack(a),t.localParticipant.emit("trackUnpublished",e),a.stop(),o(!1)},a.onended=l.current,o(!0)})).catch(n)})).catch((function(e){"AbortError"!==e.name&&"NotAllowedError"!==e.name&&n(e)}))}),[t,n]),s=Object(a.useCallback)((function(){c?l.current():u()}),[c,u,l]);return[c,s]}(),i=Object(v.a)(n,2),c=i[0],o=i[1],l=X(),u=H().room,s=l&&l!==u.localParticipant,d=navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia,f=e.disabled||s||!d,m="Share Screen";return c&&(m="Stop Sharing Screen"),s&&(m="Cannot share screen when another user is sharing"),d||(m="Screen sharing is not supported with this browser"),r.a.createElement(O.a,{title:m,placement:"top",PopperProps:{disablePortal:!0},style:{cursor:f?"not-allowed":"pointer"}},r.a.createElement("div",null,r.a.createElement(b.a,{className:t.fab,onClick:o,disabled:f},c?r.a.createElement(J.a,null):r.a.createElement(Q.a,null))))}var ee=n(163),te=n.n(ee);function ne(){var e=H().room,t=Object(a.useState)("disconnected"),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var t=function(){return i(e.state||"disconnected")};return t(),e.on("disconnected",t).on("reconnected",t).on("reconnecting",t),function(){e.off("disconnected",t).off("reconnected",t).off("reconnecting",t)}}),[e]),r}var ae=Object(d.a)((function(e){return Object(f.a)({container:Object(s.a)({display:"flex",position:"absolute",right:"50%",transform:"translate(50%, 30px)",bottom:"50px",zIndex:1,transition:"opacity 1.2s, transform 1.2s, visibility 0s 1.2s",opacity:0,visibility:"hidden",maxWidth:"min-content","&.showControls, &:hover":{transition:"opacity 0.6s, transform 0.6s, visibility 0s",opacity:1,visibility:"visible",transform:"translate(50%, 0px)"}},e.breakpoints.down("xs"),{bottom:"".concat(e.sidebarMobileHeight+3,"px")})})}));function re(){var e=ae(),t=ne(),n="reconnecting"===t,i=function(){var e=Object(a.useState)(!0),t=Object(v.a)(e,2),n=t[0],r=t[1],i=Object(a.useRef)(0);return Object(a.useEffect)((function(){var e=te()((function(){r(!0),clearTimeout(i.current);var e=window.setTimeout((function(){return r(!1)}),5e3);i.current=e}),500);return e(),window.addEventListener("mousemove",e),window.addEventListener("click",e),window.addEventListener("keydown",e),function(){window.removeEventListener("mousemove",e),window.removeEventListener("click",e),window.removeEventListener("keydown",e),clearTimeout(i.current)}}),[]),n}()||"disconnected"===t;return r.a.createElement("div",{className:Object(m.a)(e.container,{showControls:i})},r.a.createElement(W,{disabled:n}),r.a.createElement(q,{disabled:n}),"disconnected"!==t&&r.a.createElement(r.a.Fragment,null,r.a.createElement($,{disabled:n})))}function ie(e){var t=Object(a.useState)(null===e||void 0===e?void 0:e.mediaStreamTrack),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){if(i(null===e||void 0===e?void 0:e.mediaStreamTrack),e){var t=function(){return i(e.mediaStreamTrack)};return e.on("started",t),function(){e.off("started",t)}}}),[e]),r}var ce=Object(u.a)("video")({width:"100%",maxHeight:"100%",objectFit:"contain"});function oe(e){var t=e.track,n=e.isLocal,i=e.priority,c=Object(a.useRef)(null),o=ie(t);Object(a.useEffect)((function(){var e=c.current;return e.muted=!0,t.setPriority&&i&&t.setPriority(i),t.attach(e),function(){t.detach(e),t.setPriority&&i&&t.setPriority(null)}}),[t,i]);var l="environment"!==(null===o||void 0===o?void 0:o.getSettings().facingMode),u=n&&l?{transform:"rotateY(180deg)"}:{};return r.a.createElement(ce,{ref:c,style:u})}function le(){var e=H().localTracks.find((function(e){return e.name.includes("camera")}));return e?r.a.createElement(oe,{track:e,isLocal:!0}):null}var ue=n(348),se=n(165),de=n.n(se),fe=n(38),me=n.n(fe),ve=n(164),be=n.n(ve),pe=n(342);function he(){var e=function(){var e=Object(a.useState)(!!me.a.fullscreenElement),t=Object(v.a)(e,2),n=t[0],r=t[1];Object(a.useEffect)((function(){var e=function(){return r(!!me.a.fullscreenElement)};return me.a.addEventListener("fullscreenchange",e),function(){me.a.removeEventListener("fullscreenchange",e)}}),[]);var i=Object(a.useCallback)((function(){n?me.a.exitFullscreen():me.a.requestFullscreen(document.documentElement)}),[n]);return[n,i]}(),t=Object(v.a)(e,2),n=t[0],i=t[1];return me.a.fullscreenEnabled?r.a.createElement(pe.a,{"aria-label":"full screen",onClick:i},n?r.a.createElement(be.a,null):r.a.createElement(de.a,null)):null}var ge,Ee=n(349),Oe=n(173),je=n(365),ke=n(167),we=n.n(ke),Se=n(361),Te=n(359),ye=n(345),Pe=n(346),Ce=n(347),xe=n(343),Ae=n(102),_e=n(358),Le=n(367),Ne=0,De=window.AudioContext||window.webkitAudioContext;function Re(e){var t=(ge=ge||new De).createMediaStreamSource(e),n=ge.createAnalyser();return n.smoothingTimeConstant=.4,n.fftSize=512,t.connect(n),n}var Ie=r.a.memo((function(e){var t=e.size,n=e.audioTrack,i=e.background,c=t||24,o=Object(a.useRef)(null),l=Object(a.useState)(),u=Object(v.a)(l,2),s=u[0],d=u[1],f=j(n),m=ie(n);Object(a.useEffect)((function(){if(n&&m&&f){var e=new MediaStream([m.clone()]),t=function(){return e.getTracks().forEach((function(e){return e.stop()}))};n.on("stopped",t);var a=function(){t(),e=new MediaStream([m.clone()]),d(Re(e))};return d(Re(e)),window.addEventListener("focus",a),function(){t(),window.removeEventListener("focus",a),n.off("stopped",t)}}}),[f,m,n]),Object(a.useEffect)((function(){var e=o.current;if(f&&e&&s){var t=new Uint8Array(s.frequencyBinCount),n=Object(Le.a)((function(){s.getByteFrequencyData(t);for(var n=0,a=t.length,r=0;r<a;r++)n+=t[r];var i=Math.min(21,Math.max(0,14*Math.log10(n/a/3)));null===e||void 0===e||e.setAttribute("y",String(21-i))}),50);return function(){e.setAttribute("y","21"),n.stop()}}}),[f,s]);var b="audio-level-clip-".concat(Ne++);return f?r.a.createElement("svg",{focusable:"false",viewBox:"0 0 24 24","aria-hidden":"true",height:"".concat(c,"px"),width:"".concat(c,"px")},r.a.createElement("defs",null,r.a.createElement("clipPath",{id:b},r.a.createElement("rect",{ref:o,x:"0",y:"21",width:"24",height:"24"}))),r.a.createElement("path",{fill:i||"rgba(255, 255, 255, 0.1)",d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"}),r.a.createElement("path",{fill:"#0c0",clipPath:"url(#".concat(b,")"),d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"})):r.a.createElement(E.a,{height:"".concat(c,"px"),width:"".concat(c,"px"),style:{width:"initial",height:"initial"},"data-cy-audio-mute-icon":!0})}));function Ve(){var e=H().localTracks.find((function(e){return"audio"===e.kind}));return r.a.createElement(Ie,{size:30,audioTrack:e})}function He(){var e=Object(a.useState)([]),t=Object(v.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){var e=function(){return navigator.mediaDevices.enumerateDevices().then((function(e){return e.every((function(e){return!(e.deviceId&&e.label)}))})).then((function(e){if(e)return navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){return e.getTracks().forEach((function(e){return e.stop()}))}))})).then((function(){return navigator.mediaDevices.enumerateDevices().then((function(e){return r(e)}))}))};return navigator.mediaDevices.addEventListener("devicechange",e),e(),function(){navigator.mediaDevices.removeEventListener("devicechange",e)}}),[]),n}var Ue=Object(d.a)({container:{display:"flex",alignItems:"flex-end",justifyContent:"space-between"}});function We(){var e=Ue(),t=He().filter((function(e){return"audioinput"===e.kind})),n=H().localTracks.find((function(e){return"audio"===e.kind})),a=ie(n),i=null===a||void 0===a?void 0:a.getSettings().deviceId;return r.a.createElement("div",{className:e.container},r.a.createElement("div",{className:"inputSelect"},t.length>1?r.a.createElement(xe.a,{fullWidth:!0},r.a.createElement(Ae.a,{variant:"h6"},"Audio Input:"),r.a.createElement(_e.a,{onChange:function(e){return t=e.target.value,void(null===n||void 0===n||n.restart({deviceId:{exact:t}}));var t},value:i||""},t.map((function(e){return r.a.createElement(je.a,{value:e.deviceId,key:e.deviceId},e.label)})))):r.a.createElement(r.a.Fragment,null,r.a.createElement(Ae.a,{variant:"h6"},"Audio Input:"),r.a.createElement(Ae.a,null,(null===n||void 0===n?void 0:n.mediaStreamTrack.label)||"No Local Audio"))),r.a.createElement(Ve,null))}var Be=n(36),Me=n.n(Be),Ke=n(50),Fe={trackSwitchOffMode:"predicted",dominantSpeakerPriority:"standard",bandwidthProfileMode:"collaboration",maxTracks:P?"5":"10",maxAudioBitrate:"16000",renderDimensionLow:"low",renderDimensionStandard:"540p",renderDimensionHigh:"720p"};!function(){var e={};for(var t in Fe)e[t]=t}();function ze(e,t){return Object(A.a)(Object(A.a)({},e),{},Object(s.a)({},t.name,"default"===t.value?void 0:t.value))}var qe=n(65),Ge=(n(302),{apiKey:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_TOKEN_ENDPOINT:"https://us-central1-juntochat-dev.cloudfunctions.net/token"}).REACT_APP_FIREBASE_API_KEY,authDomain:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_TOKEN_ENDPOINT:"https://us-central1-juntochat-dev.cloudfunctions.net/token"}).REACT_APP_FIREBASE_AUTH_DOMAIN,databaseURL:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_TOKEN_ENDPOINT:"https://us-central1-juntochat-dev.cloudfunctions.net/token"}).REACT_APP_FIREBASE_DATABASE_URL,storageBucket:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_TOKEN_ENDPOINT:"https://us-central1-juntochat-dev.cloudfunctions.net/token"}).REACT_APP_FIREBASE_STORAGE_BUCKET,messagingSenderId:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_TOKEN_ENDPOINT:"https://us-central1-juntochat-dev.cloudfunctions.net/token"}).REACT_APP_FIREBASE_MESSAGING_SENDER_ID});var Qe=n(43);function Ye(){var e=new URLSearchParams(window.location.search).get("passcode"),t=e||window.sessionStorage.getItem("passcode");return console.log(e),console.log(t),t}function Je(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return fetch("https://us-central1-juntochat-dev.cloudfunctions.net/token",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({user_identity:e,room_name:t,passcode:n,create_room:a})})}function Xe(e){return Je("temp-name","temp-room",e,!1).then(function(){var e=Object(Ke.a)(Me.a.mark((function e(t){var n,a;return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:if(n=e.sent,401!==t.status){e.next=5;break}return e.abrupt("return",{isValid:!1,error:null===(a=n.error)||void 0===a?void 0:a.message});case 5:if(!t.ok||!n.token){e.next=7;break}return e.abrupt("return",{isValid:!0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function Ze(e){switch(e){case"passcode incorrect":return"Passcode is incorrect";case"passcode expired":return"Passcode has expired";default:return e}}var $e=Object(a.createContext)(null);function et(e){var t=Object(a.useState)(null),n=Object(v.a)(t,2),i=n[0],c=n[1],o=Object(a.useState)(!1),l=Object(v.a)(o,2),u=l[0],s=l[1],d=Object(a.useState)("default"),f=Object(v.a)(d,2),m=f[0],b=f[1],p=Object(a.useReducer)(ze,Fe),h=Object(v.a)(p,2),g=h[0],E=h[1],O={error:i,setError:c,isFetching:u,activeSinkId:m,setActiveSinkId:b,settings:g,dispatchSetting:E};O="firebase"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_TOKEN_ENDPOINT:"https://us-central1-juntochat-dev.cloudfunctions.net/token"}).REACT_APP_SET_AUTH?Object(A.a)(Object(A.a)({},O),function(){var e=Object(a.useState)(null),t=Object(v.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(!1),c=Object(v.a)(i,2),o=c[0],l=c[1],u=Object(a.useCallback)(function(){var e=Object(Ke.a)(Me.a.mark((function e(t,a){var r,i,c;return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new window.Headers,e.next=3,n.getIdToken();case 3:return i=e.sent,r.set("Authorization",i),"https://us-central1-juntochat-dev.cloudfunctions.net/token",c=new window.URLSearchParams({identity:t,roomName:a}),e.abrupt("return",fetch("".concat("https://us-central1-juntochat-dev.cloudfunctions.net/token","?").concat(c),{headers:r}).then((function(e){return e.text()})));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[n]);Object(a.useEffect)((function(){qe.initializeApp(Ge),qe.auth().onAuthStateChanged((function(e){r(e),l(!0)}))}),[]);var s=Object(a.useCallback)((function(){var e=new qe.auth.GoogleAuthProvider;return e.addScope("https://www.googleapis.com/auth/plus.login"),qe.auth().signInWithPopup(e).then((function(e){r(e.user)}))}),[]),d=Object(a.useCallback)((function(){return qe.auth().signOut().then((function(){r(null)}))}),[]);return{user:n,signIn:s,signOut:d,isAuthReady:o,getToken:u}}()):"passcode"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_TOKEN_ENDPOINT:"https://us-central1-juntochat-dev.cloudfunctions.net/token"}).REACT_APP_SET_AUTH?Object(A.a)(Object(A.a)({},O),function(){var e=Object(Qe.d)(),t=Object(a.useState)(null),n=Object(v.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)(!1),o=Object(v.a)(c,2),l=o[0],u=o[1],s=Object(a.useState)(),d=Object(v.a)(s,2),f=d[0],m=d[1],b=Object(a.useCallback)((function(e,t){return Je(e,t,Ye()).then(function(){var e=Object(Ke.a)(Me.a.mark((function e(t){var n,a,r;return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,t.json();case 4:throw a=e.sent,r=Ze((null===(n=a.error)||void 0===n?void 0:n.message)||t.statusText),Error(r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return e.json()})).then((function(e){return m(e.room_type),e.token}))}),[r]);return Object(a.useEffect)((function(){var t=Ye();t?Xe(t).then((function(n){(null===n||void 0===n?void 0:n.isValid)&&(i({passcode:t}),window.sessionStorage.setItem("passcode",t),e.replace(window.location.pathname))})).then((function(){return u(!0)})):u(!0)}),[e]),{user:r,isAuthReady:l,getToken:b,signIn:Object(a.useCallback)((function(e){return Xe(e).then((function(t){if(!(null===t||void 0===t?void 0:t.isValid))throw new Error(Ze(null===t||void 0===t?void 0:t.error));i({passcode:e}),window.sessionStorage.setItem("passcode",e)}))}),[]),signOut:Object(a.useCallback)((function(){return i(null),window.sessionStorage.removeItem("passcode"),Promise.resolve()}),[]),roomType:f}}()):Object(A.a)(Object(A.a)({},O),{},{getToken:function(){var e=Object(Ke.a)(Me.a.mark((function e(t,n){var a,r;return Me.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new window.Headers,"https://us-central1-juntochat-dev.cloudfunctions.net/token",r=new window.URLSearchParams({identity:t,roomName:n}),e.abrupt("return",fetch("".concat("https://us-central1-juntochat-dev.cloudfunctions.net/token","?").concat(r),{headers:a}).then((function(e){return e.text()})));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()});return r.a.createElement($e.Provider,{value:Object(A.a)(Object(A.a)({},O),{},{getToken:function(e,t){return s(!0),O.getToken(e,t).then((function(e){return s(!1),e})).catch((function(e){return c(e),s(!1),Promise.reject(e)}))}})},e.children)}function tt(){var e=Object(a.useContext)($e);if(!e)throw new Error("useAppState must be used within the AppStateProvider");return e}function nt(){var e,t=He().filter((function(e){return"audiooutput"===e.kind})),n=tt(),a=n.activeSinkId,i=n.setActiveSinkId,c=null===(e=t.find((function(e){return e.deviceId===a})))||void 0===e?void 0:e.label;return r.a.createElement("div",{className:"inputSelect"},t.length>1?r.a.createElement(xe.a,{fullWidth:!0},r.a.createElement(Ae.a,{variant:"h6"},"Audio Output:"),r.a.createElement(_e.a,{onChange:function(e){return i(e.target.value)},value:a},t.map((function(e){return r.a.createElement(je.a,{value:e.deviceId,key:e.deviceId},e.label)})))):r.a.createElement(r.a.Fragment,null,r.a.createElement(Ae.a,{variant:"h6"},"Audio Output:"),r.a.createElement(Ae.a,null,c||"System Default Audio Output")))}var at=n(344),rt=Object(d.a)({preview:{width:"150px",margin:"0.5em 0"}});function it(){var e=rt(),t=He().filter((function(e){return"videoinput"===e.kind})),n=H().localTracks.find((function(e){return"video"===e.kind})),a=ie(n),i=null===a||void 0===a?void 0:a.getSettings().deviceId;return r.a.createElement("div",null,t.length>1?r.a.createElement(xe.a,null,r.a.createElement(Ae.a,{variant:"h6"},"Video Input:"),r.a.createElement(_e.a,{onChange:function(e){return t=e.target.value,void n.restart(Object(A.a)(Object(A.a)({},_),{},{deviceId:{exact:t}}));var t},value:i||""},t.map((function(e){return r.a.createElement(je.a,{value:e.deviceId,key:e.deviceId},e.label)})))):r.a.createElement(r.a.Fragment,null,r.a.createElement(Ae.a,{variant:"h6"},"Video Input:"),r.a.createElement(Ae.a,null,(null===n||void 0===n?void 0:n.mediaStreamTrack.label)||"No Local Video")),n&&r.a.createElement("div",{className:e.preview},r.a.createElement(oe,{isLocal:!0,track:n})))}var ct=Object(d.a)({listSection:{margin:"2em 0","&:first-child":{margin:"1em 0 2em 0"}}});function ot(e){var t=e.className,n=e.hidden,a=ct();return r.a.createElement(at.a,{className:t,hidden:n},r.a.createElement("div",{className:a.listSection},r.a.createElement(We,null)),r.a.createElement("div",{className:a.listSection},r.a.createElement(nt,null)),r.a.createElement("div",{className:a.listSection},r.a.createElement(it,null)))}var lt=Object(d.a)((function(e){var t;return Object(f.a)({container:(t={width:"525px",minHeight:"400px"},Object(s.a)(t,e.breakpoints.down("xs"),{width:"calc(100vw - 32px)"}),Object(s.a)(t,"& .inputSelect",{width:"calc(100% - 35px)"}),t),button:{float:"right"},paper:Object(s.a)({},e.breakpoints.down("xs"),{margin:"16px"})})}));function ut(e){var t=e.open,n=e.onClose,i=lt(),c=Object(a.useState)(0),o=Object(v.a)(c,2),l=o[0],u=o[1];return r.a.createElement(Se.a,{open:t,onClose:n,classes:{paper:i.paper}},r.a.createElement(Te.a,{value:l,onChange:function(e,t){u(t)}},r.a.createElement(ye.a,{label:"Devices"})),r.a.createElement(ot,{className:i.container,hidden:0!==l}),r.a.createElement(Pe.a,null,r.a.createElement(Ce.a,{className:i.button,onClick:n},"Done")))}function st(){var e=tt(),t=(e.user,e.signOut),n=H(),i=n.room,c=n.localTracks,o=Object(a.useState)(!1),l=Object(v.a)(o,2),u=(l[0],l[1],Object(a.useState)(!1)),s=Object(v.a)(u,2),d=s[0],f=s[1],m=Object(a.useState)(!1),b=Object(v.a)(m,2),p=b[0],h=b[1],g=Object(a.useRef)(null);Object(a.useCallback)((function(){var e;null===(e=i.disconnect)||void 0===e||e.call(i),c.forEach((function(e){return e.stop()})),null===t||void 0===t||t()}),[i.disconnect,c,t]);return r.a.createElement("div",{ref:g},r.a.createElement(pe.a,{color:"inherit",onClick:function(){return f((function(e){return!e}))}},r.a.createElement(we.a,null)),r.a.createElement(Oe.a,{open:d,onClose:function(){return f((function(e){return!e}))},anchorEl:g.current},r.a.createElement(je.a,{onClick:function(){return h(!0)}},"Settings")),r.a.createElement(ut,{open:p,onClose:function(){h(!1),f(!1)}}))}var dt=n(168),ft=n.n(dt),mt=n(83);function vt(){var e=H().localTracks,t=Object(a.useState)(null),n=Object(v.a)(t,2),i=n[0],c=n[1],o=e.find((function(e){return e.name.includes("camera")})),l=ie(o);Object(a.useEffect)((function(){var e=null===l||void 0===l?void 0:l.getSettings().facingMode;!mt.isAndroid&&e&&null===i&&c(!0)}),[l,i]);var u=Object(a.useCallback)((function(){var e="user"===(null===l||void 0===l?void 0:l.getSettings().facingMode)?"environment":"user";o.restart(Object(A.a)(Object(A.a)({},_),{},{facingMode:e}))}),[l,o]);return i?r.a.createElement(pe.a,{onClick:u,disabled:!o},r.a.createElement(ft.a,null)):null}var bt=Object(d.a)((function(e){return Object(f.a)({container:{backgroundColor:e.palette.background.default},toolbar:Object(s.a)({},e.breakpoints.down("xs"),{padding:0}),rightButtonContainer:{display:"flex",alignItems:"center",marginLeft:"auto"},form:Object(s.a)({display:"flex",flexWrap:"wrap",alignItems:"center"},e.breakpoints.up("md"),{marginLeft:"2.2em"}),textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),maxWidth:200},loadingSpinner:{marginLeft:"1em"},displayName:{margin:"1.1em 0.6em",minWidth:"200px",fontWeight:600},joinButton:{margin:"1em"}})}));function pt(){var e=bt(),t=ne(),n=H().room,i=Object(a.useState)(null),c=Object(v.a)(i,2),o=c[0],l=c[1];return Object(a.useEffect)((function(){var e=new URLSearchParams(window.location.search);l(e.get("title")||n.name)}),[n]),r.a.createElement(ue.a,{className:e.container,position:"static"},r.a.createElement(Ee.a,{className:e.toolbar},"disconnected"===t?r.a.createElement("h3",null,"Connecting..."):r.a.createElement("h3",null,o),r.a.createElement("div",{className:e.rightButtonContainer},r.a.createElement(vt,null),r.a.createElement(Ve,null),r.a.createElement(he,null),r.a.createElement(st,null))))}var ht=n(169),gt=n.n(ht),Et=n(366),Ot=n(350),jt=Object(d.a)({snackbar:{backgroundColor:"#6db1ff"},message:{display:"flex",alignItems:"center"},icon:{marginRight:"0.8em"}});function kt(){var e=jt(),t=ne();return r.a.createElement(Et.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:"reconnecting"===t},r.a.createElement(Ot.a,{className:e.snackbar,message:r.a.createElement("span",{className:e.message},r.a.createElement(gt.a,{className:e.icon}),"Reconnecting\u2026")}))}var wt=n(170),St=n.n(wt),Tt=Object(u.a)("div")({position:"absolute",zIndex:1,width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}),yt=Object(u.a)("h3")({textAlign:"center",margin:"0.6em 0"});function Pt(){return r.a.createElement(Tt,null,r.a.createElement("div",null,r.a.createElement(St.a,{fontSize:"large"})),r.a.createElement(yt,null,"Insufficient Bandwidth"))}var Ct=Object(u.a)("div")({display:"flex",alignItems:"flex-end","& div":{width:"2px",border:"1px solid black",boxSizing:"content-box","&:not(:last-child)":{borderRight:"none"}}});function xt(e){var t=e.qualityLevel;return null===t?null:r.a.createElement(Ct,null,[0,1,2,3,4].map((function(e){return r.a.createElement("div",{key:e,style:{height:"".concat(3*(e+1),"px"),background:t>e?"#0c0":"#040"}})})))}var At=Object(d.a)({indicator:{width:"10px",height:"10px",borderRadius:"100%",background:"#0c0",display:"inline-block",marginRight:"3px"},isReconnecting:{background:"#ffb100"}});function _t(e){var t=function(e){var t=Object(a.useState)(!1),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var t=function(){return i(!0)},n=function(){return i(!1)};return e.on("reconnecting",t),e.on("reconnected",n),function(){e.off("reconnecting",t),e.off("reconnected",n)}}),[e]),r}(e.participant),n=At();return r.a.createElement(O.a,{title:t?"Participant is reconnecting":"Participant is connected"},r.a.createElement("span",{className:Object(m.a)(n.indicator,Object(s.a)({},n.isReconnecting,t))}))}var Lt=n(171),Nt=n(79);function Dt(){return r.a.createElement(O.a,{title:"Participant is pinned. Click to un-pin.",placement:"top"},r.a.createElement(Nt.a,{style:{float:"right",fontSize:"29px"}},r.a.createElement(Lt.a,null)))}var Rt=n(70);function It(e){var t=Object(a.useState)([]),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){i(Array.from(e.tracks.values()));var t=function(e){return i((function(t){return[].concat(Object(Rt.a)(t),[e])}))},n=function(e){return i((function(t){return t.filter((function(t){return t!==e}))}))};return e.on("trackPublished",t),e.on("trackUnpublished",n),function(){e.off("trackPublished",t),e.off("trackUnpublished",n)}}),[e]),r}function Vt(e){var t=Object(a.useState)(e&&e.isSwitchedOff),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){if(i(e&&e.isSwitchedOff),e){var t=function(){return i(!0)},n=function(){return i(!1)};return e.on("switchedOff",t),e.on("switchedOn",n),function(){e.off("switchedOff",t),e.off("switchedOn",n)}}}),[e]),!!r}function Ht(e){var t=Object(a.useState)(e&&e.track),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){if(i(e&&e.track),e){var t=function(){return i(null)};return e.on("subscribed",i),e.on("unsubscribed",t),function(){e.off("subscribed",i),e.off("unsubscribed",t)}}}),[e]),r}var Ut=Object(d.a)((function(e){return Object(f.a)({container:Object(s.a)({position:"relative",display:"flex",alignItems:"center",height:"".concat(9*e.sidebarWidth/16,"px"),overflow:"hidden",cursor:"pointer","& video":{filter:"none"},"& svg":{stroke:"black",strokeWidth:"0.8px"}},e.breakpoints.down("xs"),{height:e.sidebarMobileHeight,width:"".concat(16*e.sidebarMobileHeight/9,"px"),marginRight:"3px",fontSize:"10px"}),isVideoSwitchedOff:{"& video":{filter:"blur(4px) grayscale(1) brightness(0.5)"}},infoContainer:{position:"absolute",zIndex:1,display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",padding:"0.4em",width:"100%",background:"transparent"},hideVideo:{background:"black"},identity:{background:"rgba(0, 0, 0, 0.7)",padding:"0.1em 0.3em",margin:0,display:"flex",alignItems:"center"},infoRow:{display:"flex",justifyContent:"space-between"}})}));function Wt(e){var t=e.participant,n=e.onClick,i=e.isSelected,c=e.children,o=It(t),l=o.find((function(e){return"audio"===e.kind})),u=o.find((function(e){return e.trackName.includes("camera")})),d=function(e){var t=Object(a.useState)(e.networkQualityLevel),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var t=function(e){return i(e)};return i(e.networkQualityLevel),e.on("networkQualityLevelChanged",t),function(){e.off("networkQualityLevelChanged",t)}}),[e]),r}(t),f=Boolean(u),b=o.find((function(e){return e.trackName.includes("screen")})),p=Vt(Ht(u)),h=Ht(l),g=Ut();return r.a.createElement("div",{className:Object(m.a)(g.container,Object(s.a)({},g.isVideoSwitchedOff,p)),onClick:n,"data-cy-participant":t.identity},r.a.createElement("div",{className:Object(m.a)(g.infoContainer,Object(s.a)({},g.hideVideo,!f))},r.a.createElement("div",{className:g.infoRow},r.a.createElement("h4",{className:g.identity},r.a.createElement(_t,{participant:t}),t.identity),r.a.createElement(xt,{qualityLevel:d})),r.a.createElement("div",null,r.a.createElement(Ie,{audioTrack:h,background:"white"}),!f&&r.a.createElement(F.a,null),b&&r.a.createElement(Q.a,null),i&&r.a.createElement(Dt,null))),p&&r.a.createElement(Pt,null),c)}function Bt(e){var t=e.track,n=tt().activeSinkId,r=Object(a.useRef)();return Object(a.useEffect)((function(){return r.current=t.attach(),r.current.setAttribute("data-cy-audio-track-name",t.name),document.body.appendChild(r.current),function(){return t.detach().forEach((function(e){return e.remove()}))}}),[t]),Object(a.useEffect)((function(){var e,t;null===(e=r.current)||void 0===e||null===(t=e.setSinkId)||void 0===t||t.call(e,n)}),[n]),null}function Mt(e){var t=e.publication,n=e.isLocal,a=e.disableAudio,i=e.videoPriority,c=Ht(t);if(!c)return null;switch(c.kind){case"video":return r.a.createElement(oe,{track:c,priority:i,isLocal:c.name.includes("camera")&&n});case"audio":return a?null:r.a.createElement(Bt,{track:c});default:return null}}function Kt(e){var t,n=e.participant,a=e.disableAudio,i=e.enableScreenShare,c=e.videoPriority,o=H().room,l=It(n),u=n===o.localParticipant;return t=i&&l.some((function(e){return e.trackName.includes("screen")}))?l.filter((function(e){return!e.trackName.includes("camera")})):l.filter((function(e){return!e.trackName.includes("screen")})),r.a.createElement(r.a.Fragment,null,t.map((function(e){return r.a.createElement(Mt,{key:e.kind,publication:e,participant:n,isLocal:u,disableAudio:a,videoPriority:c})})))}function Ft(e){var t=e.participant,n=e.disableAudio,a=e.enableScreenShare,i=e.onClick,c=e.isSelected;return r.a.createElement(Wt,{participant:t,onClick:i,isSelected:c},r.a.createElement(Kt,{participant:t,disableAudio:n,enableScreenShare:a}))}function zt(){var e=H().room,t=Object(a.useState)(e.dominantSpeaker),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var t=function(e){console.log("dominant speaker changed"),console.log(null===e||void 0===e?void 0:e.identity),console.log(null===e||void 0===e?void 0:e.sid),null!==e&&i(e)},n=function(e){i((function(t){return t===e?null:t}))};return e.on("dominantSpeakerChanged",t),e.on("participantDisconnected",n),function(){e.off("dominantSpeakerChanged",t),e.off("participantDisconnected",n)}}),[e]),r}function qt(){var e=H().room,t=zt(),n=Object(a.useState)(Array.from(e.participants.values())),r=Object(v.a)(n,2),i=r[0],c=r[1];return Object(a.useEffect)((function(){t&&c((function(e){return[t].concat(Object(Rt.a)(e.filter((function(e){return e!==t}))))}))}),[t]),Object(a.useEffect)((function(){var t=function(e){return c((function(t){return[].concat(Object(Rt.a)(t),[e])}))},n=function(e){return c((function(t){return t.filter((function(t){return t!==e}))}))};return e.on("participantConnected",t),e.on("participantDisconnected",n),function(){e.off("participantConnected",t),e.off("participantDisconnected",n)}}),[e]),i}var Gt=Object(u.a)("aside")((function(e){var t=e.theme;return Object(s.a)({padding:"0.5em",overflowY:"auto"},t.breakpoints.down("xs"),{overflowY:"initial",overflowX:"auto",padding:0,display:"flex"})})),Qt=Object(u.a)("div")((function(e){var t=e.theme;return Object(s.a)({},t.breakpoints.down("xs"),{display:"flex"})}));function Yt(){var e=H().room.localParticipant,t=qt(),n=w(),a=Object(v.a)(n,2),i=a[0],c=a[1];return r.a.createElement(Gt,null,r.a.createElement(Qt,null,r.a.createElement(Ft,{participant:e,isSelected:i===e,onClick:function(){return c(e)}}),t.map((function(e){return r.a.createElement(Ft,{key:e.sid,participant:e,isSelected:i===e,onClick:function(){return c(e)}})}))))}var Jt=Object(d.a)({container:{position:"relative",display:"flex",alignItems:"center",gridArea:"participantList"},isVideoSwitchedOff:{"& video":{filter:"blur(4px) grayscale(1) brightness(0.5)"}},identity:{background:"rgba(0, 0, 0, 0.7)",padding:"0.1em 0.3em",margin:"1em",fontSize:"1.2em",display:"inline-flex","& svg":{marginLeft:"0.3em"}},infoContainer:{position:"absolute",zIndex:1,height:"100%",padding:"0.4em",width:"100%"}});function Xt(e){var t=e.participant,n=e.children,a=Jt(),i=It(t),c=i.find((function(e){return e.trackName.includes("camera")})),o=i.find((function(e){return e.trackName.includes("screen")})),l=Boolean(c),u=Vt(Ht(o||c));return r.a.createElement("div",{"data-cy-main-participant":!0,className:Object(m.a)(a.container,Object(s.a)({},a.isVideoSwitchedOff,u))},r.a.createElement("div",{className:a.infoContainer},r.a.createElement("h4",{className:a.identity},t.identity,!l&&r.a.createElement(F.a,null))),u&&r.a.createElement(Pt,null),n)}function Zt(){var e=function(){var e=w(),t=Object(v.a)(e,1)[0],n=X(),a=zt(),r=qt(),i=H().room.localParticipant;return t||n||a||r[0]||i}(),t=w(),n=Object(v.a)(t,1)[0],a=X(),i=e===n||e===a?"high":null;return r.a.createElement(Xt,{participant:e},r.a.createElement(Kt,{participant:e,disableAudio:!0,enableScreenShare:!0,videoPriority:i}))}var $t=Object(u.a)("div")((function(e){var t=e.theme;return Object(s.a)({position:"relative",height:"100%",display:"grid",gridTemplateColumns:"".concat(t.sidebarWidth,"px 1fr"),gridTemplateAreas:'". participantList"',gridTemplateRows:"100%"},t.breakpoints.down("xs"),{gridTemplateAreas:'"participantList" "."',gridTemplateColumns:"auto",gridTemplateRows:"calc(100% - ".concat(t.sidebarMobileHeight+12,"px) ").concat(t.sidebarMobileHeight+6,"px"),gridGap:"6px"})}));function en(){return r.a.createElement($t,null,r.a.createElement(Yt,null),r.a.createElement(Zt,null))}var tn=Object(u.a)("div")({display:"grid",gridTemplateRows:"auto 1fr"}),nn=Object(u.a)("main")({overflow:"hidden"});function an(){var e=ne(),t=function(){var e,t=Object(a.useState)(window.innerHeight*((null===(e=window.visualViewport)||void 0===e?void 0:e.scale)||1)),n=Object(v.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var e=function(){var e;i(window.innerHeight*((null===(e=window.visualViewport)||void 0===e?void 0:e.scale)||1))};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}})),r+"px"}();return r.a.createElement(tn,{style:{height:t}},r.a.createElement(pt,null),r.a.createElement(nn,null,"disconnected"===e?r.a.createElement(le,null):r.a.createElement(en,null),r.a.createElement(re,null)),r.a.createElement(kt,null))}var rn=n(99),cn=n(351),on=n(352);var ln=function(e){var t=e.dismissError,n=e.error,a=n||{},i=a.message,c=a.code,o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t){case 20101:return e+". Please make sure you are using the correct credentials.";default:return e}}(i,c);return r.a.createElement(Se.a,{open:null!==n,onClose:function(){return t()},fullWidth:!0,maxWidth:"xs"},r.a.createElement(cn.a,null,"ERROR"),r.a.createElement(at.a,null,r.a.createElement(on.a,null,o),c&&r.a.createElement("pre",null,r.a.createElement("code",null,"Error Code: ",c))),r.a.createElement(Pe.a,null,r.a.createElement(Ce.a,{onClick:function(){return t()},color:"primary",autoFocus:!0},"OK")))};var un=function(){var e=Object(a.useState)(!1),t=Object(v.a)(e,2),n=t[0],i=t[1],c=H().getLocalVideoTrack,o=H().connect,l=tt(),u=l.setError,s=l.getToken,d=Object(a.useCallback)((function(){c();var e=new URLSearchParams(window.location.search),t=e.get("room"),n=e.get("identity");t&&n?(console.log("getting token"),s(n,t).then((function(e){console.log("connect"),o(e)})).catch((function(e){return console.log(e)})).finally((function(){return console.log("finally")})),i(!0)):u(new Error("Must provide room and identity in url params."))}),[c,o,s,u]);return r.a.createElement(Se.a,{open:!n,onClose:function(){return d()},fullWidth:!0,maxWidth:"xs"},r.a.createElement(cn.a,null,"Start Video"),r.a.createElement(at.a,null,r.a.createElement(on.a,null,"Launch video stream?")),r.a.createElement(Pe.a,null,r.a.createElement(Ce.a,{onClick:function(){return d()},color:"primary",autoFocus:!0},"OK")))},sn=n(172),dn=Object(sn.a)({palette:{type:"dark",primary:{main:"#F22F46"}},sidebarWidth:260,sidebarMobileHeight:90}),fn=[{label:"Low (160 x 90)",value:"low",resolution:{width:160,height:90}},{label:"CIF (352 x 288)",value:"cif",resolution:{width:352,height:288}},{label:"VGA (640 x 480)",value:"vga",resolution:{width:640,height:480}},{label:"WVGA (800 x 480)",value:"wvga",resolution:{width:800,height:480}},{label:"HD 540P (960 x 540)",value:"540p",resolution:{width:960,height:540}},{label:"HD 720P (1280 x 720)",value:"720p",resolution:{width:1280,height:720}},{label:"HD 960P (1280 x 960)",value:"960p",resolution:{width:1280,height:960}},{label:"HD Standard 1080P (1440 x 1080)",value:"standard1080p",resolution:{width:1440,height:1080}},{label:"HD Widescreen 1080P (1920 x 1080)",value:"wide1080p",resolution:{width:1920,height:1080}},{label:"Server Default",value:"default",resolution:void 0}];function mn(e){var t;if("undefined"!==typeof e)return null===(t=fn.find((function(t){return t.value===e})))||void 0===t?void 0:t.resolution}function vn(){var e,t=tt(),n=t.roomType,a=t.settings,r={bandwidthProfile:{video:{mode:a.bandwidthProfileMode,dominantSpeakerPriority:a.dominantSpeakerPriority,renderDimensions:{low:mn(a.renderDimensionLow),standard:mn(a.renderDimensionStandard),high:mn(a.renderDimensionHigh)},maxTracks:Number(a.maxTracks)}},dominantSpeaker:!0,networkQuality:{local:1,remote:1},maxAudioBitrate:Number(a.maxAudioBitrate),preferredVideoCodecs:[{codec:"VP8",simulcast:"peer-to-peer"!==n}]};return P&&(null===r||void 0===r||null===(e=r.bandwidthProfile)||void 0===e?void 0:e.video)&&(r.bandwidthProfile.video.maxSubscriptionBitrate=25e5),function e(t){if(!y()(t))return t;var n={};for(var a in t){var r=t[a];"undefined"!==typeof r&&(n[a]=e(r))}return n}(r)}var bn=n(353),pn=n(354),hn=n(175),gn=n(355),En=Object(d.a)({container:{marginTop:"2.5em"},paper:{padding:"1em"},heading:{marginBottom:"0.4em"}}),On=function(e){var t=e.children,n=En();return N.a.isSupported?t:r.a.createElement(bn.a,null,r.a.createElement(pn.a,{container:!0,justify:"center",className:n.container},r.a.createElement(pn.a,{item:!0,xs:12,sm:6},r.a.createElement(hn.a,{className:n.paper},r.a.createElement(Ae.a,{variant:"h4",className:n.heading},"Browser or context not supported"),r.a.createElement(Ae.a,null,"Please open this application in one of the"," ",r.a.createElement(gn.a,{href:"https://www.twilio.com/docs/video/javascript#supported-browsers",target:"_blank",rel:"noopener"},"supported browsers"),".",r.a.createElement("br",null),"If you are using a supported browser, please ensure that this app is served over a"," ",r.a.createElement(gn.a,{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts",target:"_blank",rel:"noopener"},"secure context")," ","(e.g. https or localhost).")))))},jn=function(){var e=tt(),t=e.error,n=e.setError,a=vn();return mt.mobileModel.startsWith("Pixel")&&(console.log("MobileModel starts with Pixel."),a.preferredVideoCodecs=["H264"]),r.a.createElement(On,null,r.a.createElement(V,{options:a,onError:n},r.a.createElement(ln,{dismissError:function(){return n(null)},error:t}),r.a.createElement(un,null),r.a.createElement(an,null)))};c.a.render(r.a.createElement(l.a,{theme:dn},r.a.createElement(o.a,null),r.a.createElement(rn.a,null,r.a.createElement(et,null,r.a.createElement(jn,null)))),document.getElementById("root"))}},[[188,1,2]]]);
//# sourceMappingURL=main.b8d333c6.chunk.js.map